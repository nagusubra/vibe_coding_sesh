<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Security-Policy" content="script-src 'self'; object-src 'none'; connect-src https://api.perplexity.ai;">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RotCheck</title>
  <link rel="stylesheet" href="popup.css" />
</head>
<body>
  <div class="container">
    <header class="header">
  <div class="title">RotCheck</div>
      <button id="resetKey" class="link">Change API Key</button>
    </header>

    <section id="setup" class="card" style="display:none;">
      <div class="h">First-time setup</div>
      <label for="apiKey" class="muted">Perplexity API Key</label>
      <input id="apiKey" type="password" placeholder="pplx-..." />
      <button id="saveKey" class="btn">Save & Analyze</button>
      <div id="keyHelp" class="help muted">Your key is stored locally via chrome.storage.</div>
      <div id="keyStatus" class="status muted"></div>
    </section>

    <section id="verdictCard" class="card" style="display:none;">
      <div id="status" class="status">Analyzing…</div>
      <div class="verdict-line" id="verdictLine" style="display:none;">
        <span>AI Verdict: </span>
        <span id="verdict" class="verdict"></span>
        <span id="confidence" class="confidence"><span id="confidenceValue"></span> confidence</span>
      </div>
      <div class="spectrum" id="spectrum" aria-hidden="true">
        <div class="pointer" id="spectrumPointer" aria-label="Verdict spectrum pointer"></div>
      </div>
      <div class="spectrumStages" id="spectrumStages">
        <span data-pos="0.05" data-verdict="brainrot">
          <div class="stage-emoji">💀</div>
          <div class="stage-text">brainrot</div>
        </span>
        <span data-pos="0.25" data-verdict="doomscroll">
          <div class="stage-emoji">📉</div>
          <div class="stage-text">doomscroll</div>
        </span>
        <span data-pos="0.45" data-verdict="meh">
          <div class="stage-emoji">😐</div>
          <div class="stage-text">meh</div>
        </span>
        <span data-pos="0.70" data-verdict="decent">
          <div class="stage-emoji">👌</div>
          <div class="stage-text">decent</div>
        </span>
        <span data-pos="0.95" data-verdict="peak">
          <div class="stage-emoji">🚀</div>
          <div class="stage-text">peak</div>
        </span>
      </div>
      <div id="timeSpent" class="muted" style="font-size:11px;margin-top:8px;">Time on this page: --:--</div>
      <div id="verdictGif" class="verdictGif" style="display:none;">
        <img id="gifImage" src="" alt="Verdict GIF" style="width:100%;height:200px;object-fit:cover;border-radius:8px;">
      </div>
      <pre id="reason" class="reason"></pre>
      <div id="learningPrompt" class="learningPrompt" style="display:none;">
        <div class="h" style="font-size:12px;margin-bottom:6px;">🧠 Level up your brain instead!</div>
        <div id="learningLinks" class="learningLinks"></div>
      </div>
    </section>

    <section id="avoidBrainrotCard" class="card" style="display:none;">
      <div class="h" style="color:#ff5c5c;">🧠 Escape the Brainrot!</div>
      <div class="muted" style="font-size:12px;margin-bottom:8px;">Here are some quality alternatives to level up:</div>
      <div id="avoidBrainrotLinks" class="learningLinks"></div>
    </section>

    <section id="linksCard" class="card" style="display:none;">
      <div class="h" style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
        <span>Top Links Scan</span>
        <button id="analyzeLinks" class="btn small">Analyze Links</button>
      </div>
      <div id="linksStatus" class="status muted">Idle</div>
      <div id="linksResults" class="links"></div>
    </section>

    <footer class="footer muted">
  RotCheck v1.0 • Perplexity Sonar
      <div style="margin-top:6px;">
        <button id="statsBtn" class="link smallLink" type="button">stats for nerds</button>
      </div>
    </footer>
    <section id="statsPanel" class="card statsPanel" style="display:none;max-height:200px;overflow:auto;">
      <div class="h" style="display:flex;justify-content:space-between;align-items:center;gap:4px;">
        <span>Debug Data</span>
        <div style="display:flex;gap:6px;align-items:center;">
          <button id="maxStats" class="link" type="button" title="Expand">maximize</button>
          <button id="closeStats" class="link" type="button">close</button>
        </div>
      </div>
      <div class="muted" style="font-size:11px;margin-bottom:6px;">Raw payload & model reply (truncated). No API key shown.</div>
      <pre id="statsContent" style="white-space:pre-wrap;font-size:11px;line-height:1.3;background:#0f1736;border:1px dashed #2a3b78;padding:8px;border-radius:8px;max-height:120px;overflow:auto;"></pre>
    </section>
  </div>
  <script src="popup.js"></script>
</body>
</html>
